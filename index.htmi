<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>同棲タスクリスト</title>
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <header class="top">
    <div class="wrap">
      <div class="title">
        <h1>同棲タスク & 家計</h1>
        <p class="subtitle">GitHubで共有＆更新（JSONが正）</p>
      </div>

      <div class="actions">
        <button id="btnExportTasks" class="btn">タスクJSON書き出す</button>
        <button id="btnExportFinance" class="btn">家計JSON書き出す</button>

        <label class="btn ghost">
          タスクJSON読み込み
          <input id="fileImportTasks" type="file" accept="application/json" hidden />
        </label>
        <label class="btn ghost">
          家計JSON読み込み
          <input id="fileImportFinance" type="file" accept="application/json" hidden />
        </label>
      </div>
    </div>
  </header>

  <main class="wrap">
    <nav class="tabs">
      <button class="tab active" data-tab="tasks">タスク</button>
      <button class="tab" data-tab="finance">家計</button>
    </nav>

    <!-- ========= TASKS ========= -->
    <section id="tab-tasks" class="tabpane show">
      <section class="panel">
        <div class="panel-head">
          <h2>タスク追加</h2>
          <p class="muted">担当は自由入力。繰り返しは「毎週」＋曜日で設定できます。</p>
        </div>

        <datalist id="assigneeHints"></datalist>

        <form id="taskForm" class="form">
          <div class="grid">
            <label>
              タスク名
              <input id="fTitle" required maxlength="80" placeholder="例）ゴミ出し" />
            </label>

            <label>
              担当（自由入力）
              <input id="fAssignee" list="assigneeHints" maxlength="24" placeholder="例）うて / 彼 / ふたり" />
            </label>

            <label>
              カテゴリ
              <select id="fCategory">
                <option value="家事">家事</option>
                <option value="買い物">買い物</option>
                <option value="手続き">手続き</option>
                <option value="お金">お金</option>
                <option value="掃除">掃除</option>
                <option value="その他">その他</option>
              </select>
            </label>

            <label>
              期限
              <input id="fDue" type="date" />
            </label>

            <label>
              優先度
              <select id="fPriority">
                <option value="中">中</option>
                <option value="高">高</option>
                <option value="低">低</option>
              </select>
            </label>

            <label>
              メモ
              <input id="fNote" maxlength="120" placeholder="例）燃えるゴミ/朝8:30まで" />
            </label>
          </div>

          <div class="repeatbox">
            <label class="checkline">
              <input id="fRepeatOn" type="checkbox" />
              繰り返し（毎週）
            </label>

            <div id="repeatWeekly" class="repeat-weekly">
              <span class="muted">曜日：</span>
              <label class="chip"><input type="checkbox" value="MO" class="wd">月</label>
              <label class="chip"><input type="checkbox" value="TU" class="wd">火</label>
              <label class="chip"><input type="checkbox" value="WE" class="wd">水</label>
              <label class="chip"><input type="checkbox" value="TH" class="wd">木</label>
              <label class="chip"><input type="checkbox" value="FR" class="wd">金</label>
              <label class="chip"><input type="checkbox" value="SA" class="wd">土</label>
              <label class="chip"><input type="checkbox" value="SU" class="wd">日</label>

              <span class="muted" style="margin-left:8px;">開始日：</span>
              <input id="fRepeatStart" type="date" />
            </div>
          </div>

          <div class="row">
            <button class="btn primary" type="submit">追加する</button>
            <button class="btn ghost" type="button" id="btnReset">入力をクリア</button>
          </div>
        </form>
      </section>

      <section class="panel">
        <div class="panel-head">
          <h2>一覧</h2>
          <div class="filters">
            <input id="q" class="search" placeholder="検索（タスク名/メモ）" />
            <select id="filterStatus">
              <option value="all">すべて</option>
              <option value="open">未完了</option>
              <option value="done">完了</option>
            </select>
            <input id="filterAssignee" class="search" placeholder="担当で絞り込み（例：うて）" />
            <select id="filterCategory">
              <option value="all">カテゴリ：すべて</option>
              <option value="家事">家事</option>
              <option value="買い物">買い物</option>
              <option value="手続き">手続き</option>
              <option value="お金">お金</option>
              <option value="掃除">掃除</option>
              <option value="その他">その他</option>
            </select>
            <select id="sortBy">
              <option value="next">次回/期限が近い順</option>
              <option value="created">追加が新しい順</option>
              <option value="priority">優先度が高い順</option>
            </select>
          </div>
        </div>

        <div id="stats" class="stats"></div>
        <div id="list" class="list"></div>
      </section>
    </section>

    <!-- ========= FINANCE ========= -->
    <section id="tab-finance" class="tabpane">
      <section class="panel">
        <div class="panel-head">
          <h2>家計追加</h2>
          <p class="muted">「誰が払ったか」と「対象（ふたり/片方）」で自動精算します。</p>
        </div>

        <datalist id="personHints"></datalist>

        <form id="financeForm" class="form">
          <div class="grid financegrid">
            <label>
              日付
              <input id="pDate" type="date" required />
            </label>

            <label>
              金額
              <input id="pAmount" type="number" min="0" step="1" required placeholder="例）5800" />
            </label>

            <label>
              支払った人
              <input id="pPayer" list="personHints" required maxlength="24" placeholder="例）うて" />
            </label>

            <label>
              対象
              <select id="pSplit">
                <option value="both">ふたり（折半）</option>
                <option value="me">私だけ</option>
                <option value="partner">彼だけ</option>
              </select>
            </label>

            <label>
              カテゴリ
              <select id="pCategory">
                <option value="家賃">家賃</option>
                <option value="食費">食費</option>
                <option value="日用品">日用品</option>
                <option value="光熱費">光熱費</option>
                <option value="通信費">通信費</option>
                <option value="外食">外食</option>
                <option value="その他">その他</option>
              </select>
            </label>

            <label>
              メモ
              <input id="pNote" maxlength="120" placeholder="例）スーパー / 電気代" />
            </label>
          </div>

          <div class="row">
            <button class="btn primary" type="submit">追加する</button>
            <button class="btn ghost" type="button" id="btnResetPay">入力をクリア</button>
          </div>
        </form>
      </section>

      <section class="panel">
        <div class="panel-head">
          <h2>家計サマリ</h2>
          <div class="filters">
            <input id="fromDate" type="date" />
            <span class="muted">〜</span>
            <input id="toDate" type="date" />
            <button id="btnThisMonth" class="btn ghost" type="button">今月</button>
            <button id="btnClearRange" class="btn ghost" type="button">範囲クリア</button>
          </div>
        </div>

        <div id="financeStats" class="stats"></div>
        <div id="settlement" class="settlement"></div>
        <div id="payList" class="list"></div>
      </section>
    </section>

    <footer class="footer muted">
      <p>
        共同更新：①画面で編集→JSON書き出し→②GitHubの <code>tasks.json</code>/<code>finance.json</code> を置き換えコミット
        （またはGitHub上で直接JSON編集）
      </p>
    </footer>
  </main>

  <dialog id="editDialog" class="dialog">
    <form method="dialog" class="dialog-inner" id="editForm">
      <h3>タスク編集</h3>
      <input type="hidden" id="eId" />
      <label>タスク名<input id="eTitle" required maxlength="80" /></label>

      <div class="grid2">
        <label>担当（自由入力）<input id="eAssignee" list="assigneeHints" maxlength="24" /></label>
        <label>カテゴリ
          <select id="eCategory">
            <option value="家事">家事</option>
            <option value="買い物">買い物</option>
            <option value="手続き">手続き</option>
            <option value="お金">お金</option>
            <option value="掃除">掃除</option>
            <option value="その他">その他</option>
          </select>
        </label>
        <label>期限<input id="eDue" type="date" /></label>
        <label>優先度
          <select id="ePriority">
            <option value="中">中</option>
            <option value="高">高</option>
            <option value="低">低</option>
          </select>
        </label>
      </div>

      <label>メモ<input id="eNote" maxlength="120" /></label>

      <label class="checkline" style="margin-top:6px;">
        <input id="eRepeatOn" type="checkbox" />
        繰り返し（毎週）
      </label>

      <div id="eRepeatWeekly" class="repeat-weekly">
        <span class="muted">曜日：</span>
        <label class="chip"><input type="checkbox" value="MO" class="ewd">月</label>
        <label class="chip"><input type="checkbox" value="TU" class="ewd">火</label>
        <label class="chip"><input type="checkbox" value="WE" class="ewd">水</label>
        <label class="chip"><input type="checkbox" value="TH" class="ewd">木</label>
        <label class="chip"><input type="checkbox" value="FR" class="ewd">金</label>
        <label class="chip"><input type="checkbox" value="SA" class="ewd">土</label>
        <label class="chip"><input type="checkbox" value="SU" class="ewd">日</label>

        <span class="muted" style="margin-left:8px;">開始日：</span>
        <input id="eRepeatStart" type="date" />
      </div>

      <div class="row right">
        <button class="btn ghost" value="cancel" type="button" id="btnCancelEdit">キャンセル</button>
        <button class="btn primary" value="ok" type="submit">保存</button>
      </div>
    </form>
  </dialog>

  <script src="./app.js"></script>
</body>
</html>
